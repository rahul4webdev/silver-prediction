# OpenLiteSpeed vhost configuration for prediction.gahfaudio.in
# Copy this to: /usr/local/lsws/conf/vhosts/prediction.gahfaudio.in/vhconf.conf
# Or add via CyberPanel -> Websites -> prediction.gahfaudio.in -> vHost Conf

# Document Root
docRoot                   /home/prediction.gahfaudio.in/public_html/frontend

# Enable access log
accesslog /home/prediction.gahfaudio.in/logs/access.log {
  useServer               0
  logFormat               "%h %l %u %t \"%r\" %>s %b"
  logHeaders              5
  rollingSize             10M
  keepDays                30
}

# Error log
errorlog /home/prediction.gahfaudio.in/logs/error.log {
  useServer               0
  logLevel                WARN
  rollingSize             10M
  keepDays                30
}

# External app for Next.js (PM2)
extprocessor nextjs {
  type                    proxy
  address                 127.0.0.1:3000
  maxConns                100
  pcKeepAliveTimeout      60
  initTimeout             60
  retryTimeout            0
  respBuffer              0
}

# Rewrite rules
rewrite  {
  enable                  1
  autoLoadHtaccess        1

  rules                   <<<END_RULES
# Proxy all requests to Next.js running on port 3000
RewriteEngine On

# Static files from Next.js
RewriteRule ^/_next/(.*)$ http://127.0.0.1:3000/_next/$1 [P,L]

# API routes if any (Next.js API routes)
RewriteRule ^/api/(.*)$ http://127.0.0.1:3000/api/$1 [P,L]

# All other routes to Next.js
RewriteRule ^(.*)$ http://127.0.0.1:3000$1 [P,L]
END_RULES
}

# Context for all routes - proxy to Next.js
context / {
  type                    proxy
  handler                 nextjs
  addDefaultCharset       off
}

# Static assets caching
context /_next/static {
  type                    proxy
  handler                 nextjs
  addDefaultCharset       off

  extraHeaders            <<<END_HEADERS
Cache-Control: public, max-age=31536000, immutable
END_HEADERS
}

# Security settings
security {
  accessControl {
    allow                 *
  }
}
